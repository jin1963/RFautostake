async function connectWallet() {
  try {
    const accounts = await window.ethereum.request({ method: "eth_requestAccounts" });
    user = accounts[0];
    web3 = new Web3(window.ethereum);
    contract = new web3.eth.Contract(contractABI, contractAddress);
    usdt = new web3.eth.Contract(usdtABI, usdtAddress);

    document.getElementById("status").innerHTML = `✅ Connected:<br>${user}`;
    updateReferralLink();
    await showReferrer();  // ✅ แสดง Referrer ของผู้ใช้
    loadStakes();
  } catch (err) {
    console.error(err);
    document.getElementById("status").innerText = "❌ เชื่อมต่อไม่สำเร็จ";
  }
}

async function showReferrer() {
  try {
    const refAddr = await contract.methods.referrerOf(user).call();
    const display = (refAddr && refAddr !== "0x0000000000000000000000000000000000000000") 
        ? `${refAddr}` : "ยังไม่มี";
    document.getElementById("myReferrer").innerText = display;
  } catch (e) {
    console.error("เกิดข้อผิดพลาดในการอ่าน referrer:", e);
    document.getElementById("myReferrer").innerText = "ไม่สามารถดึงข้อมูลได้";
  }
}
